<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard NPS - Vegas Vigil칙ncia</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #f4f6f9;
            --card-bg: #ffffff;
            --primary: #0d1114;
            --text: #333;
            --subtext: #777;
            --accent: #FF6384;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 20px;
        }

        .container {
            padding: 20px;
            max-width: 1100px;
            margin: auto;
        }

        .grafico,
        .comentarios-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .top-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .top-bar input,
        .top-bar select {
            padding: 8px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .nps-box {
            background: #e0f7e9;
            padding: 15px;
            border-left: 5px solid #00c853;
            border-radius: 8px;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 20px;
        }

        canvas {
            max-width: 100%;
        }

        .comentarios-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .card-comentario {
            background: #f9f9f9;
            border-left: 5px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            flex: 1 1 300px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .card-comentario:hover {
            transform: scale(1.01);
        }

        .nota {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .nome {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .comentario {
            font-style: italic;
            color: var(--subtext);
            margin-bottom: 10px;
        }

        .extras {
            font-size: 12px;
            color: var(--subtext);
        }

        @media (max-width: 600px) {
            .card-comentario {
                flex: 1 1 100%;
            }

            .top-bar {
                flex-direction: column;
                align-items: stretch;
            }

            footer {
                background-color: #0d1114;
                font: 400;
                color: white;
            }
            img {
      width: 50px;
      height: 50px;
            }
        }
    </style>
</head>

<body>
    <header>
        <img src="./assets/LOGO-VEGAS.png" alt="">
        <h1>Dashboard - Coment치rios e Notas NPS</h1>
    </header>

    <div class="container">

        <!-- GR츼FICO DE PIZZA -->
        <div class="grafico">
            <h2>Distribui칞칚o das Notas</h2>
            <canvas id="graficoPizza"></canvas>
        </div>

        <!-- COMENT츼RIOS E FILTROS -->
        <div class="comentarios-section">
            <div class="top-bar">
                <input type="text" id="buscaNome" placeholder="游댌 Buscar por nome...">
                <select id="filtroNota">
                    <option value="">Filtrar por nota</option>
                    ${[...Array(11).keys()].map(n => `<option value="${n}">${n}</option>`).join("")}
                </select>
            </div>

            <div id="npsBox" class="nps-box">
                Calculando NPS...
            </div>

            <div class="comentarios-container" id="comentariosContainer">
                <!-- Cards ser칚o inseridos aqui -->
            </div>
        </div>
    </div>
    <footer>
        <p>Vegas Vigil칙ncia<br>
            Monitoramento 24h - Seguran칞a Residencial e Empresarial<br>
            춸 2025 Vegas Vigil칙ncia. Todos os direitos reservados.</p>
    </footer>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyiGedsPHMibL87lObnRy_nKfHWxhhIOd1gJG14A1fkilz9Mw9dCGaJsxciYsbMIfZGbA/exec";

        let respostasOriginais = [];

        async function buscarDados() {
            const resposta = await fetch(API_URL);
            const dados = await resposta.json();
            return dados.map(item => ({
                nota: Number(item.nota),
                nome: item.nome?.trim() || "Sem nome",
                telefone: item.telefone || "-",
                endereco: item.endereco || "-",
                comentarios: item.comentarios || "Sem coment치rio"
            }));
        }

        function gerarGraficoPizza(respostas) {
            const contagemNotas = new Array(11).fill(0);
            respostas.forEach(r => contagemNotas[r.nota]++);

            const ctx = document.getElementById('graficoPizza').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: contagemNotas.map((_, i) => `Nota ${i}`),
                    datasets: [{
                        label: 'Notas',
                        data: contagemNotas,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#E7E9ED', '#8BC34A',
                            '#795548', '#607D8B', '#3F51B5'
                        ],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function calcularNPS(respostas) {
            const total = respostas.length;
            const promotores = respostas.filter(r => r.nota >= 9).length;
            const detratores = respostas.filter(r => r.nota <= 6).length;
            const nps = Math.round(((promotores - detratores) / total) * 100);
            document.getElementById("npsBox").textContent = `NPS: ${nps} (Promotores: ${promotores}, Detratores: ${detratores}, Total: ${total})`;
        }

        function preencherComentarios(respostas) {
            const container = document.getElementById("comentariosContainer");
            container.innerHTML = "";

            if (respostas.length === 0) {
                container.innerHTML = "<p>Nenhum resultado encontrado.</p>";
                return;
            }

            respostas.forEach(r => {
                const card = document.createElement("div");
                card.className = "card-comentario";

                card.innerHTML = `
          <div class="nota">Nota: ${r.nota}</div>
          <div class="nome">${r.nome}</div>
          <div class="comentario">"${r.comentarios}"</div>
          <div class="extras">
            Tel: ${r.telefone}<br>
            Endere칞o: ${r.endereco}
          </div>
        `;

                container.appendChild(card);
            });
        }

        function aplicarFiltros() {
            const nomeFiltro = document.getElementById("buscaNome").value.toLowerCase();
            const notaFiltro = document.getElementById("filtroNota").value;

            let filtradas = respostasOriginais;

            if (nomeFiltro) {
                filtradas = filtradas.filter(r => r.nome.toLowerCase().includes(nomeFiltro));
            }

            if (notaFiltro !== "") {
                filtradas = filtradas.filter(r => r.nota == notaFiltro);
            }

            preencherComentarios(filtradas);
        }

        // Eventos de filtro
        document.getElementById("buscaNome").addEventListener("input", aplicarFiltros);
        document.getElementById("filtroNota").addEventListener("change", aplicarFiltros);

        // Inicializa
        buscarDados()
            .then(respostas => {
                respostasOriginais = respostas;
                gerarGraficoPizza(respostas);
                preencherComentarios(respostas);
                calcularNPS(respostas);
            })
            .catch(erro => {
                console.error("Erro ao buscar dados:", erro);
                document.querySelector(".container").innerHTML = "<p>Erro ao carregar os dados. Verifique a conex칚o ou a URL da API.</p>";
            });
    </script>
</body>

</html>